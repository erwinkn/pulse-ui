---
title: folder_lock
---

Folder lock management.

Provides a FolderLock context manager that coordinates across processes and
Uvicorn reloads using environment variables.

Example: prevent multiple Pulse dev instances per web root.

<Tabs items={["Class","Functions"]}>

<Tab value={"Class"}>

<Cards >

<Card title={"FolderLock"} href={"/docs/api/pulse/cli/folder_lock/FolderLock"} />

</Cards>

</Tab>
<Tab value={"Functions"}>

<PyFunction name={"is_process_alive"} type={"(pid) -> bool"}>

Check if a process with the given PID is running.

<PySourceCode >

```python
def is_process_alive(pid: int) -> bool:
	"""Check if a process with the given PID is running."""
	try:
		# On POSIX, signal 0 checks for existence without killing
		os.kill(pid, 0)
	except ProcessLookupError:
		return False
	except PermissionError:
		# Process exists but we may not have permission
		return True
	except Exception:
		# Best-effort: assume alive if uncertain
		return True
	return True
```

</PySourceCode>

<div >

<PyParameter name={"pid"} type={"int"} value={null} />

</div>

<PyFunctionReturn type={"bool"} />

</PyFunction>
<PyFunction name={"_read_lock"} type={"(lock_path) -> dict[str, Any] | None"}>

Read and parse lock file contents.

<PySourceCode >

```python
def _read_lock(lock_path: Path) -> dict[str, Any] | None:
	"""Read and parse lock file contents."""
	try:
		data = json.loads(lock_path.read_text())
		if isinstance(data, dict):
			return data
	except Exception:
		return None
	return None
```

</PySourceCode>

<div >

<PyParameter name={"lock_path"} type={"Path"} value={null} />

</div>

<PyFunctionReturn type={"dict[str, typing.Any] | None"} />

</PyFunction>
<PyFunction name={"_write_gitignore_for_lock"} type={"(lock_path) -> None"}>

Add lock file to .gitignore if not already present.

<PySourceCode >

```python
def _write_gitignore_for_lock(lock_path: Path) -> None:
	"""Add lock file to .gitignore if not already present."""

	ensure_gitignore_has(lock_path.parent, lock_path.name)
```

</PySourceCode>

<div >

<PyParameter name={"lock_path"} type={"Path"} value={null} />

</div>

<PyFunctionReturn type={"None"} />

</PyFunction>
<PyFunction name={"_create_lock_file"} type={"(lock_path) -> None"}>

Create a lock file with current process information.

<PySourceCode >

```python
def _create_lock_file(lock_path: Path) -> None:
	"""Create a lock file with current process information."""
	lock_path = Path(lock_path)
	_write_gitignore_for_lock(lock_path)

	if lock_path.exists():
		info = _read_lock(lock_path) or {}
		pid = int(info.get("pid", 0) or 0)
		if pid and is_process_alive(pid):
			raise RuntimeError(
				f"Another Pulse dev instance appears to be running (pid={pid}) for {lock_path.parent}."
			)
		# Stale lock; continue to overwrite

	payload = {
		"pid": os.getpid(),
		"created_at": int(time.time()),
		"hostname": socket.gethostname(),
		"platform": platform.platform(),
		"python": platform.python_version(),
		"cwd": os.getcwd(),
	}
	try:
		lock_path.parent.mkdir(parents=True, exist_ok=True)
		lock_path.write_text(json.dumps(payload))
	except Exception as exc:
		raise RuntimeError(f"Failed to create lock file at {lock_path}: {exc}") from exc
```

</PySourceCode>

<div >

<PyParameter name={"lock_path"} type={"Path"} value={null} />

</div>

<PyFunctionReturn type={"None"} />

</PyFunction>
<PyFunction name={"_remove_lock_file"} type={"(lock_path) -> None"}>

Remove lock file (best-effort).

<PySourceCode >

```python
def _remove_lock_file(lock_path: Path) -> None:
	"""Remove lock file (best-effort)."""
	try:
		Path(lock_path).unlink(missing_ok=True)
	except Exception:
		# Best-effort cleanup
		pass
```

</PySourceCode>

<div >

<PyParameter name={"lock_path"} type={"Path"} value={null} />

</div>

<PyFunctionReturn type={"None"} />

</PyFunction>
<PyFunction name={"lock_path_for_web_root"} type={"(web_root, filename='.pulse/lock') -> Path"}>

Return the lock file path for a given web root.

<PySourceCode >

```python
def lock_path_for_web_root(web_root: Path, filename: str = ".pulse/lock") -> Path:
	"""Return the lock file path for a given web root."""
	return Path(web_root) / filename
```

</PySourceCode>

<div >

<PyParameter name={"web_root"} type={"Path"} value={null} />
<PyParameter name={"filename"} type={"str"} value={"'.pulse/lock'"} />

</div>

<PyFunctionReturn type={"pathlib.Path"} />

</PyFunction>

</Tab>

</Tabs>