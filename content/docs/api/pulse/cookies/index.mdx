---
title: cookies
---

<Tabs items={["Class","Functions"]}>

<Tab value={"Class"}>

<Cards >

<Card title={"Cookie"} href={"/docs/api/pulse/cookies/Cookie"} />
<Card title={"SetCookie"} href={"/docs/api/pulse/cookies/SetCookie"} />
<Card title={"CORSOptions"} href={"/docs/api/pulse/cookies/CORSOptions"} />

</Cards>

</Tab>
<Tab value={"Functions"}>

<PyFunction name={"session_cookie"} type={"(mode, name='pulse.sid', max_age_seconds=7 * 24 * 3600)"}>

<PySourceCode >

```python
def session_cookie(
	mode: "PulseMode",
	name: str = "pulse.sid",
	max_age_seconds: int = 7 * 24 * 3600,
):
	if mode == "single-server":
		return Cookie(
			name,
			domain=None,
			secure=None,
			samesite="lax",
			max_age_seconds=max_age_seconds,
		)
	elif mode == "subdomains":
		return Cookie(
			name,
			domain=None,  # to be set later
			secure=True,
			samesite="lax",
			max_age_seconds=max_age_seconds,
		)
	else:
		raise ValueError(f"Unexpected cookie mode: '{mode}'")
```

</PySourceCode>

<div >

<PyParameter name={"mode"} type={"PulseMode"} value={null} />
<PyParameter name={"name"} type={"str"} value={"'pulse.sid'"} />
<PyParameter name={"max_age_seconds"} type={"int"} value={"7 * 24 * 3600"} />

</div>

<PyFunctionReturn type={null} />

</PyFunction>
<PyFunction name={"_parse_host"} type={"(server_address) -> str | None"}>

<PySourceCode >

```python
def _parse_host(server_address: str) -> str | None:
	try:
		if not server_address:
			return None
		host = urlparse(server_address).hostname
		return host
	except Exception:
		return None
```

</PySourceCode>

<div >

<PyParameter name={"server_address"} type={"str"} value={null} />

</div>

<PyFunctionReturn type={"str | None"} />

</PyFunction>
<PyFunction name={"_base_domain"} type={"(host) -> str"}>

<PySourceCode >

```python
def _base_domain(host: str) -> str:
	# Simplified rule: drop the leftmost label, keep everything to the right.
	# Assumes host is a subdomain (e.g., api.example.com -> example.com).
	i = host.find(".")
	return host[i + 1 :] if i != -1 else host
```

</PySourceCode>

<div >

<PyParameter name={"host"} type={"str"} value={null} />

</div>

<PyFunctionReturn type={"str"} />

</PyFunction>
<PyFunction name={"compute_cookie_domain"} type={"(mode, server_address) -> str | None"}>

<PySourceCode >

```python
def compute_cookie_domain(mode: "PulseMode", server_address: str) -> str | None:
	host = _parse_host(server_address)
	if mode == "single-server" or not host:
		return None
	if mode == "subdomains":
		return "." + _base_domain(host)
	return None
```

</PySourceCode>

<div >

<PyParameter name={"mode"} type={"PulseMode"} value={null} />
<PyParameter name={"server_address"} type={"str"} value={null} />

</div>

<PyFunctionReturn type={"str | None"} />

</PyFunction>
<PyFunction name={"compute_cookie_secure"} type={"(env, server_address) -> bool"}>

<PySourceCode >

```python
def compute_cookie_secure(env: PulseEnv, server_address: str | None) -> bool:
	scheme = urlparse(server_address or "").scheme.lower()
	if scheme in ("https", "wss"):
		secure = True
	elif scheme in ("http", "ws"):
		secure = False
	else:
		secure = None
	if secure is None:
		if env in ("prod", "ci"):
			raise RuntimeError(
				"Could not determine cookie security from server_address. "
				+ "Use an explicit https:// server_address or set Cookie(secure=True/False)."
			)
		return False
	if env in ("prod", "ci") and not secure:
		raise RuntimeError(
			"Refusing to use insecure cookies in prod/ci. "
			+ "Use an https server_address or set Cookie(secure=True) explicitly."
		)
	return secure
```

</PySourceCode>

<div >

<PyParameter name={"env"} type={"PulseEnv"} value={null} />
<PyParameter name={"server_address"} type={"str | None"} value={null} />

</div>

<PyFunctionReturn type={"bool"} />

</PyFunction>
<PyFunction name={"cors_options"} type={"(mode, server_address) -> CORSOptions"}>

<PySourceCode >

```python
def cors_options(mode: "PulseMode", server_address: str) -> CORSOptions:
	host = _parse_host(server_address) or "localhost"
	opts: CORSOptions = {
		"allow_credentials": True,
		"allow_methods": ["*"],
		"allow_headers": ["*"],
	}
	if mode == "subdomains":
		base = _base_domain(host)
		# Escape dots in base domain for regex (doesn't affect localhost since it has no dots)
		base = base.replace(".", r"\.")
		# Allow any subdomain and any port for the base domain
		opts["allow_origin_regex"] = rf"^https?://([a-z0-9-]+\\.)?{base}(:\\d+)?$"
		return opts
	elif mode == "single-server":
		# For single-server mode, allow same origin
		# Escape dots in host for regex (doesn't affect localhost since it has no dots)
		host = host.replace(".", r"\.")
		opts["allow_origin_regex"] = rf"^https?://{host}(:\\d+)?$"
		return opts
	else:
		raise ValueError(f"Unsupported deployment mode '{mode}'")
```

</PySourceCode>

<div >

<PyParameter name={"mode"} type={"PulseMode"} value={null} />
<PyParameter name={"server_address"} type={"str"} value={null} />

</div>

<PyFunctionReturn type={"pulse.cookies.CORSOptions"} />

</PyFunction>
<PyFunction name={"parse_cookie_header"} type={"(header) -> dict[str, str]"}>

Parse a raw Cookie header string into a dictionary.

<Callout title={"Example"} type={"example"}>

```python
cookies = parse_cookie_header("session=abc123; theme=dark")
# \{"session": "abc123", "theme": "dark"\}
```

</Callout>

<PySourceCode >

```python
def parse_cookie_header(header: str | None) -> dict[str, str]:
	"""Parse a raw Cookie header string into a dictionary.

	Args:
		header: Raw Cookie header string (e.g., "session=abc123; theme=dark").

	Returns:
		Dictionary of cookie name-value pairs.

	Example:
		\```python
		cookies = parse_cookie_header("session=abc123; theme=dark")
		# {"session": "abc123", "theme": "dark"}
		\```
	"""
	cookies: dict[str, str] = {}
	if not header:
		return cookies
	parts = [p.strip() for p in header.split(";") if p.strip()]
	for part in parts:
		if "=" in part:
			k, v = part.split("=", 1)
			cookies[k.strip()] = v.strip()
	return cookies
```

</PySourceCode>

<div >

<PyParameter name={"header"} type={"str | None"} value={undefined}>

Raw Cookie header string (e.g., "session=abc123; theme=dark").

</PyParameter>

</div>

<PyFunctionReturn type={"dict"}>

Dictionary of cookie name-value pairs.

</PyFunctionReturn>

</PyFunction>

</Tab>

</Tabs>