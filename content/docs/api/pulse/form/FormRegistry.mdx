---
title: FormRegistry
---

Internal class managing form registrations.

Not typically used directly. Forms are registered automatically via
``ps.Form`` or ``ManualForm``.

## Functions

<PyFunction name={"__init__"} type={"(self, render) -> None"}>

<PySourceCode >

```python
def __init__(self, render: "RenderSession") -> None:
	self._render: "RenderSession" = render
	self._handlers: dict[str, FormRegistration] = {}
```

</PySourceCode>

<div >

<PyParameter name={"self"} type={null} value={null} />
<PyParameter name={"render"} type={"RenderSession"} value={null} />

</div>

<PyFunctionReturn type={"None"} />

</PyFunction>

<PyFunction name={"register"} type={"(self, render_id, route_id, session_id, on_submit) -> FormRegistration"}>

Register a form handler.

<PySourceCode >

```python
def register(
	self,
	render_id: str,
	route_id: str,
	session_id: str,
	on_submit: Callable[[FormData], Awaitable[None]],
) -> FormRegistration:
	"""Register a form handler.

	Args:
		render_id: Render session ID.
		route_id: Route path.
		session_id: User session ID.
		on_submit: Async callback for form submission.

	Returns:
		FormRegistration with generated form ID.
	"""
	registration = FormRegistration(
		uuid.uuid4().hex,
		render_id=render_id,
		route_path=route_id,
		session_id=session_id,
		on_submit=on_submit,
	)
	self._handlers[registration.id] = registration
	return registration
```

</PySourceCode>

<div >

<PyParameter name={"self"} type={null} value={null} />
<PyParameter name={"render_id"} type={"str"} value={undefined}>

Render session ID.

</PyParameter>
<PyParameter name={"route_id"} type={"str"} value={undefined}>

Route path.

</PyParameter>
<PyParameter name={"session_id"} type={"str"} value={undefined}>

User session ID.

</PyParameter>
<PyParameter name={"on_submit"} type={"Callable[[FormData], Awaitable[None]]"} value={undefined}>

Async callback for form submission.

</PyParameter>

</div>

<PyFunctionReturn type={"pulse.form.FormRegistration"}>

FormRegistration with generated form ID.

</PyFunctionReturn>

</PyFunction>

<PyFunction name={"unregister"} type={"(self, form_id) -> None"}>

Unregister a form handler.

<PySourceCode >

```python
def unregister(self, form_id: str) -> None:
	"""Unregister a form handler.

	Args:
		form_id: The form ID to unregister.
	"""
	self._handlers.pop(form_id, None)
```

</PySourceCode>

<div >

<PyParameter name={"self"} type={null} value={null} />
<PyParameter name={"form_id"} type={"str"} value={undefined}>

The form ID to unregister.

</PyParameter>

</div>

<PyFunctionReturn type={"None"} />

</PyFunction>

<PyFunction name={"dispose"} type={"(self) -> None"}>

Clean up all registered forms.

<PySourceCode >

```python
@override
def dispose(self) -> None:
	"""Clean up all registered forms."""
	self._handlers.clear()
```

</PySourceCode>

<div >

<PyParameter name={"self"} type={null} value={null} />

</div>

<PyFunctionReturn type={"None"} />

</PyFunction>

<PyFunction name={"handle_submit"} type={"(self, form_id, request, session) -> Response"}>

Handle incoming form submission.

<PySourceCode >

```python
async def handle_submit(
	self,
	form_id: str,
	request: Request,
	session: "UserSession",
) -> Response:
	"""Handle incoming form submission.

	Args:
		form_id: The form ID being submitted.
		request: The HTTP request.
		session: The user session.

	Returns:
		HTTP response (204 on success).

	Raises:
		HTTPException: If form not found (404), session mismatch (403),
			or route unmounted (410).
	"""
	registration = self._handlers.get(form_id)
	if registration is None:
		raise HTTPException(status_code=404, detail="Unknown form submission")

	if registration.session_id != session.sid:
		raise HTTPException(
			status_code=403, detail="Form does not belong to this session"
		)

	raw_form = await request.form()
	data = normalize_form_data(raw_form)

	# Deserialize complex data from __data__ field if present
	if "__data__" in data:
		data_value = data["__data__"]
		if isinstance(data_value, str):
			serialized_data = json.loads(data_value)
			deserialized_data = deserialize(serialized_data)
			# Merge deserialized data into form data, excluding __data__
			for key, value in deserialized_data.items():
				if key != "__data__":
					data[key] = value
			# Remove the __data__ field
			del data["__data__"]

	try:
		mount = self._render.get_route_mount(registration.route_path)
	except ValueError as exc:
		self.unregister(form_id)
		raise HTTPException(
			status_code=410,
			detail="Form route is no longer mounted",
		) from exc

	with PulseContext.update(render=self._render, route=mount.route):
		await call_flexible(registration.on_submit, data)

	return Response(status_code=204)
```

</PySourceCode>

<div >

<PyParameter name={"self"} type={null} value={null} />
<PyParameter name={"form_id"} type={"str"} value={undefined}>

The form ID being submitted.

</PyParameter>
<PyParameter name={"request"} type={"Request"} value={undefined}>

The HTTP request.

</PyParameter>
<PyParameter name={"session"} type={"UserSession"} value={undefined}>

The user session.

</PyParameter>

</div>

<PyFunctionReturn type={"fastapi.Response"}>

HTTP response (204 on success).

</PyFunctionReturn>

</PyFunction>