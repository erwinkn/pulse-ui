---
title: LatencyMiddleware
---

Middleware that adds artificial latency to simulate network conditions.

Useful for testing and development to simulate real-world network delays.
Defaults are realistic for typical web applications.

Example:
    ```python
    app = ps.App(
        middleware=ps.LatencyMiddleware(
            prerender_ms=100,
            connect_ms=50,
        )
    )
    ```

## Attributes

<PyAttribute name={"prerender_ms"} type={"float"} value={"prerender_ms"} />

<PyAttribute name={"prerender_route_ms"} type={"float"} value={"prerender_route_ms"} />

<PyAttribute name={"connect_ms"} type={"float"} value={"connect_ms"} />

<PyAttribute name={"message_ms"} type={"float"} value={"message_ms"} />

<PyAttribute name={"channel_ms"} type={"float"} value={"channel_ms"} />

## Functions

<PyFunction name={"__init__"} type={"(self, *, prerender_ms=80.0, prerender_route_ms=60.0, connect_ms=40.0, message_ms=25.0, channel_ms=20.0) -> None"}>

Initialize latency middleware.

<PySourceCode >

```python
def __init__(
	self,
	*,
	prerender_ms: float = 80.0,
	prerender_route_ms: float = 60.0,
	connect_ms: float = 40.0,
	message_ms: float = 25.0,
	channel_ms: float = 20.0,
) -> None:
	"""Initialize latency middleware.

	Args:
		prerender_ms: Latency for batch prerender requests (HTTP). Default: 80ms
		prerender_route_ms: Latency for individual route prerenders. Default: 60ms
		connect_ms: Latency for WebSocket connections. Default: 40ms
		message_ms: Latency for WebSocket messages (including API calls). Default: 25ms
		channel_ms: Latency for channel messages. Default: 20ms
		dev: If True, only active in dev environments. Default: True
	"""
	super().__init__(dev=True)
	self.prerender_ms = prerender_ms
	self.prerender_route_ms = prerender_route_ms
	self.connect_ms = connect_ms
	self.message_ms = message_ms
	self.channel_ms = channel_ms
```

</PySourceCode>

<div >

<PyParameter name={"self"} type={null} value={null} />
<PyParameter name={"prerender_ms"} type={"float"} value={"80.0"}>

Latency for batch prerender requests (HTTP). Default: 80ms

</PyParameter>
<PyParameter name={"prerender_route_ms"} type={"float"} value={"60.0"}>

Latency for individual route prerenders. Default: 60ms

</PyParameter>
<PyParameter name={"connect_ms"} type={"float"} value={"40.0"}>

Latency for WebSocket connections. Default: 40ms

</PyParameter>
<PyParameter name={"message_ms"} type={"float"} value={"25.0"}>

Latency for WebSocket messages (including API calls). Default: 25ms

</PyParameter>
<PyParameter name={"channel_ms"} type={"float"} value={"20.0"}>

Latency for channel messages. Default: 20ms

</PyParameter>

</div>

<PyFunctionReturn type={"None"} />

</PyFunction>

<PyFunction name={"prerender"} type={"(self, *, payload, request, session, next) -> PrerenderResponse"}>

<PySourceCode >

```python
@override
async def prerender(
	self,
	*,
	payload: "PrerenderPayload",
	request: PulseRequest,
	session: dict[str, Any],
	next: Callable[[], Awaitable[PrerenderResponse]],
) -> PrerenderResponse:
	if self.prerender_ms > 0:
		await asyncio.sleep(self.prerender_ms / 1000.0)
	return await next()
```

</PySourceCode>

<div >

<PyParameter name={"self"} type={null} value={null} />
<PyParameter name={"payload"} type={"'PrerenderPayload'"} value={null} />
<PyParameter name={"request"} type={"PulseRequest"} value={null} />
<PyParameter name={"session"} type={"dict[str, Any]"} value={null} />
<PyParameter name={"next"} type={"Callable[[], Awaitable[PrerenderResponse]]"} value={null} />

</div>

<PyFunctionReturn type={"pulse.middleware.PrerenderResponse"} />

</PyFunction>

<PyFunction name={"prerender_route"} type={"(self, *, path, request, route_info, session, next) -> RoutePrerenderResponse"}>

<PySourceCode >

```python
@override
async def prerender_route(
	self,
	*,
	path: str,
	request: PulseRequest,
	route_info: RouteInfo,
	session: dict[str, Any],
	next: Callable[[], Awaitable[RoutePrerenderResponse]],
) -> RoutePrerenderResponse:
	if self.prerender_route_ms > 0:
		await asyncio.sleep(self.prerender_route_ms / 1000.0)
	return await next()
```

</PySourceCode>

<div >

<PyParameter name={"self"} type={null} value={null} />
<PyParameter name={"path"} type={"str"} value={null} />
<PyParameter name={"request"} type={"PulseRequest"} value={null} />
<PyParameter name={"route_info"} type={"RouteInfo"} value={null} />
<PyParameter name={"session"} type={"dict[str, Any]"} value={null} />
<PyParameter name={"next"} type={"Callable[[], Awaitable[RoutePrerenderResponse]]"} value={null} />

</div>

<PyFunctionReturn type={"pulse.middleware.RoutePrerenderResponse"} />

</PyFunction>

<PyFunction name={"connect"} type={"(self, *, request, session, next) -> ConnectResponse"}>

<PySourceCode >

```python
@override
async def connect(
	self,
	*,
	request: PulseRequest,
	session: dict[str, Any],
	next: Callable[[], Awaitable[ConnectResponse]],
) -> ConnectResponse:
	if self.connect_ms > 0:
		await asyncio.sleep(self.connect_ms / 1000.0)
	return await next()
```

</PySourceCode>

<div >

<PyParameter name={"self"} type={null} value={null} />
<PyParameter name={"request"} type={"PulseRequest"} value={null} />
<PyParameter name={"session"} type={"dict[str, Any]"} value={null} />
<PyParameter name={"next"} type={"Callable[[], Awaitable[ConnectResponse]]"} value={null} />

</div>

<PyFunctionReturn type={"pulse.middleware.ConnectResponse"} />

</PyFunction>

<PyFunction name={"message"} type={"(self, *, data, session, next) -> Ok[None] | Deny"}>

<PySourceCode >

```python
@override
async def message(
	self,
	*,
	data: ClientMessage,
	session: dict[str, Any],
	next: Callable[[], Awaitable[Ok[None]]],
) -> Ok[None] | Deny:
	if self.message_ms > 0:
		await asyncio.sleep(self.message_ms / 1000.0)
	return await next()
```

</PySourceCode>

<div >

<PyParameter name={"self"} type={null} value={null} />
<PyParameter name={"data"} type={"ClientMessage"} value={null} />
<PyParameter name={"session"} type={"dict[str, Any]"} value={null} />
<PyParameter name={"next"} type={"Callable[[], Awaitable[Ok[None]]]"} value={null} />

</div>

<PyFunctionReturn type={"pulse.middleware.Ok[None] | pulse.middleware.Deny"} />

</PyFunction>

<PyFunction name={"channel"} type={"(self, *, channel_id, event, payload, request_id, session, next) -> Ok[None] | Deny"}>

<PySourceCode >

```python
@override
async def channel(
	self,
	*,
	channel_id: str,
	event: str,
	payload: Any,
	request_id: str | None,
	session: dict[str, Any],
	next: Callable[[], Awaitable[Ok[None]]],
) -> Ok[None] | Deny:
	if self.channel_ms > 0:
		await asyncio.sleep(self.channel_ms / 1000.0)
	return await next()
```

</PySourceCode>

<div >

<PyParameter name={"self"} type={null} value={null} />
<PyParameter name={"channel_id"} type={"str"} value={null} />
<PyParameter name={"event"} type={"str"} value={null} />
<PyParameter name={"payload"} type={"Any"} value={null} />
<PyParameter name={"request_id"} type={"str | None"} value={null} />
<PyParameter name={"session"} type={"dict[str, Any]"} value={null} />
<PyParameter name={"next"} type={"Callable[[], Awaitable[Ok[None]]]"} value={null} />

</div>

<PyFunctionReturn type={"pulse.middleware.Ok[None] | pulse.middleware.Deny"} />

</PyFunction>