---
title: "renderer"
---

<PyAttribute name={"PropValue"} type={"TypeAlias"} value={"Node | Callable[..., Any]"} />

<PyAttribute name={"FRAGMENT_TAG"} type={null} value={"''"} />

<PyAttribute name={"MOUNT_PREFIX"} type={null} value={"'$$'"} />

<PyAttribute name={"CALLBACK_PLACEHOLDER"} type={null} value={"'$cb'"} />

<PyAttribute name={"Callbacks"} type={null} value={"dict[str, Callback]"} />

<Tabs items={["Class","Functions"]}>

<Tab value={"Class"}>

<Cards >

<Card title={"Callback"} href={"/docs/api/pulse/renderer/Callback"} />
<Card title={"DiffPropsResult"} href={"/docs/api/pulse/renderer/DiffPropsResult"} />
<Card title={"RenderPropTask"} href={"/docs/api/pulse/renderer/RenderPropTask"} />
<Card title={"RenderTree"} href={"/docs/api/pulse/renderer/RenderTree"} />
<Card title={"Renderer"} href={"/docs/api/pulse/renderer/Renderer"} />

</Cards>

</Tab>
<Tab value={"Functions"}>

<PyFunction name={"registry_ref"} type={"(expr) -> RegistryRef | None"}>

<PySourceCode >

```python
def registry_ref(expr: Expr) -> RegistryRef | None:
	if isinstance(expr, (Import, JsFunction, Constant, JsxFunction)):
		return {"t": "ref", "key": expr.id}
	return None
```

</PySourceCode>

<div >

<PyParameter name={"expr"} type={"Expr"} value={null} />

</div>

<PyFunctionReturn type={"pulse.transpiler.vdom.RegistryRef | None"} />

</PyFunction>
<PyFunction name={"prop_requires_eval"} type={"(value) -> bool"}>

<PySourceCode >

```python
def prop_requires_eval(value: PropValue) -> bool:
	if isinstance(value, Value):
		return False
	if isinstance(value, (Element, PulseNode)):
		return True
	if isinstance(value, Expr):
		return True
	return callable(value)
```

</PySourceCode>

<div >

<PyParameter name={"value"} type={"PropValue"} value={null} />

</div>

<PyFunctionReturn type={"bool"} />

</PyFunction>
<PyFunction name={"eval_keys_for_props"} type={"(props) -> set[str]"}>

<PySourceCode >

```python
def eval_keys_for_props(props: dict[str, PropValue]) -> set[str]:
	eval_keys: set[str] = set()
	for key, value in props.items():
		if prop_requires_eval(value):
			eval_keys.add(key)
	return eval_keys
```

</PySourceCode>

<div >

<PyParameter name={"props"} type={"dict[str, PropValue]"} value={null} />

</div>

<PyFunctionReturn type={"set[str]"} />

</PyFunction>
<PyFunction name={"normalize_children"} type={"(children) -> list[Node]"}>

<PySourceCode >

```python
def normalize_children(children: Children | None) -> list[Node]:
	if not children:
		return []

	out: list[Node] = []
	seen_keys: set[str] = set()

	def register_key(item: Node) -> None:
		key: str | None = None
		if isinstance(item, PulseNode):
			key = item.key
		elif isinstance(item, Element):
			key = key_value(item)
		if key is None:
			return
		if key in seen_keys:
			raise ValueError(f"Duplicate key '{key}'")
		seen_keys.add(key)

	def visit(item: Child) -> None:
		if isinstance(item, dict):
			raise TypeError("Dict is not a valid child; wrap in Value for props")
		if isinstance(item, Iterable) and not isinstance(item, (str, bytes)):
			for sub in item:
				visit(sub)
		else:
			node = cast(Node, item)
			register_key(node)
			out.append(node)

	for child in children:
		visit(child)

	return out
```

</PySourceCode>

<div >

<PyParameter name={"children"} type={"Children | None"} value={null} />

</div>

<PyFunctionReturn type={"list[pulse.transpiler.nodes.Node]"} />

</PyFunction>
<PyFunction name={"register_callback"} type={"(callbacks, path, fn) -> None"}>

<PySourceCode >

```python
def register_callback(
	callbacks: Callbacks,
	path: str,
	fn: Callable[..., Any],
) -> None:
	n_args = len(inspect.signature(fn).parameters)
	callbacks[path] = Callback(fn=fn, n_args=n_args)
```

</PySourceCode>

<div >

<PyParameter name={"callbacks"} type={"Callbacks"} value={null} />
<PyParameter name={"path"} type={"str"} value={null} />
<PyParameter name={"fn"} type={"Callable[..., Any]"} value={null} />

</div>

<PyFunctionReturn type={"None"} />

</PyFunction>
<PyFunction name={"join_path"} type={"(prefix, path) -> str"}>

<PySourceCode >

```python
def join_path(prefix: str, path: str | int) -> str:
	if prefix:
		return f"{prefix}.{path}"
	return str(path)
```

</PySourceCode>

<div >

<PyParameter name={"prefix"} type={"str"} value={null} />
<PyParameter name={"path"} type={"str | int"} value={null} />

</div>

<PyFunctionReturn type={"str"} />

</PyFunction>
<PyFunction name={"same_node"} type={"(left, right) -> bool"}>

<PySourceCode >

```python
def same_node(left: Node, right: Node) -> bool:
	if values_equal(left, right):
		return True
	if isinstance(left, Element) and isinstance(right, Element):
		return values_equal(left.tag, right.tag) and key_value(left) == key_value(right)
	if isinstance(left, PulseNode) and isinstance(right, PulseNode):
		return left.fn == right.fn and key_value(left) == key_value(right)
	return False
```

</PySourceCode>

<div >

<PyParameter name={"left"} type={"Node"} value={null} />
<PyParameter name={"right"} type={"Node"} value={null} />

</div>

<PyFunctionReturn type={"bool"} />

</PyFunction>
<PyFunction name={"key_value"} type={"(node) -> str | None"}>

<PySourceCode >

```python
def key_value(node: Node | Node) -> str | None:
	key = getattr(node, "key", None)
	if isinstance(key, Literal):
		if not isinstance(key.value, str):
			raise TypeError("Element key must be a string")
		return key.value
	return cast(str | None, key)
```

</PySourceCode>

<div >

<PyParameter name={"node"} type={"Node | Node"} value={null} />

</div>

<PyFunctionReturn type={"str | None"} />

</PyFunction>
<PyFunction name={"unmount_element"} type={"(element) -> None"}>

<PySourceCode >

```python
def unmount_element(element: Node) -> None:
	if isinstance(element, PulseNode):
		if element.contents is not None:
			unmount_element(element.contents)
			element.contents = None
		if element.hooks is not None:
			element.hooks.unmount()
		return

	if isinstance(element, Element):
		props = element.props_dict()
		for value in props.values():
			if isinstance(value, (Element, PulseNode)):
				unmount_element(value)
		for child in normalize_children(element.children):
			unmount_element(child)
		element.children = []
		return
```

</PySourceCode>

<div >

<PyParameter name={"element"} type={"Node"} value={null} />

</div>

<PyFunctionReturn type={"None"} />

</PyFunction>

</Tab>

</Tabs>