---
title: "Pulse Client"
---

# Pulse Client

React components, hooks, and classes for connecting to a Pulse backend.

## PulseProvider

Root context provider that establishes the WebSocket connection and provides the Pulse client to descendant components.

```tsx
function PulseProvider(props: PulseProviderProps): ReactNode
```

### Props

```ts
interface PulseProviderProps {
  children: ReactNode;
  config: PulseConfig;
  prerender: PulsePrerender;
}

interface PulseConfig {
  serverAddress: string;
  connectionStatus: ConnectionStatusConfig;
}

interface ConnectionStatusConfig {
  initialConnectingDelay: number;  // ms before showing "Connecting..."
  initialErrorDelay: number;       // ms before showing error on initial connect
  reconnectErrorDelay: number;     // ms before showing error on reconnect
}

interface PulsePrerender {
  views: Record<string, PulsePrerenderView>;
  directives: Directives;
}

interface Directives {
  headers?: Record<string, string>;
  socketio?: {
    headers?: Record<string, string>;
    auth?: Record<string, string>;
  };
}
```

### Example

```tsx
import { PulseProvider } from "pulse-client";

function App() {
  return (
    <PulseProvider
      config={{
        serverAddress: "http://localhost:8000",
        connectionStatus: {
          initialConnectingDelay: 500,
          initialErrorDelay: 5000,
          reconnectErrorDelay: 3000,
        },
      }}
      prerender={{ views: {}, directives: {} }}
    >
      <Routes />
    </PulseProvider>
  );
}
```

---

## PulseView

Renders a Pulse view at a specific path. Subscribes to server updates and handles VDOM reconciliation.

```tsx
function PulseView(props: PulseViewProps): ReactNode
```

### Props

```ts
interface PulseViewProps {
  path: string;                        // View mount path
  registry: Record<string, unknown>;   // Component registry for mount points
}
```

### Example

```tsx
import { PulseView } from "pulse-client";
import { Button } from "./components";

const registry = {
  Button,
};

function MyPage() {
  return <PulseView path="/my-view" registry={registry} />;
}
```

---

## usePulseClient

Hook to access the Pulse client instance. Must be used within a `PulseProvider`.

```ts
function usePulseClient(): PulseSocketIOClient
```

### Returns

The `PulseSocketIOClient` instance managing the WebSocket connection.

### Example

```tsx
import { usePulseClient } from "pulse-client";

function ConnectionStatus() {
  const client = usePulseClient();
  const [connected, setConnected] = useState(client.isConnected());

  useEffect(() => {
    return client.onConnectionChange((status) => {
      setConnected(status === "ok");
    });
  }, [client]);

  return <div>{connected ? "Connected" : "Disconnected"}</div>;
}
```

---

## usePulseChannel

Hook to subscribe to a Pulse channel for bidirectional communication.

```ts
function usePulseChannel(channelId: string): ChannelBridge
```

### Parameters

- `channelId` - Non-empty string identifying the channel

### Returns

A `ChannelBridge` instance for the channel.

### Example

```tsx
import { usePulseChannel } from "pulse-client";

function ChatComponent({ channelId }: { channelId: string }) {
  const channel = usePulseChannel(channelId);

  useEffect(() => {
    return channel.on("message", (payload) => {
      console.log("Received:", payload);
    });
  }, [channel]);

  const sendMessage = (text: string) => {
    channel.emit("message", { text });
  };

  return <button onClick={() => sendMessage("Hello!")}>Send</button>;
}
```

---

## ChannelBridge

Manages bidirectional communication over a Pulse channel.

```ts
class ChannelBridge {
  readonly id: string;

  emit(event: string, payload?: any): void;
  request(event: string, payload?: any): Promise<any>;
  on(event: string, handler: ChannelEventHandler): () => void;
}

type ChannelEventHandler = (payload: any) => any | Promise<any>;
```

### Methods

#### emit

Sends a fire-and-forget event to the server.

```ts
emit(event: string, payload?: any): void
```

#### request

Sends a request and waits for a response.

```ts
request(event: string, payload?: any): Promise<any>
```

Throws `PulseChannelResetError` if the channel closes before response.

#### on

Registers an event handler. Returns an unsubscribe function.

```ts
on(event: string, handler: ChannelEventHandler): () => void
```

### Example

```tsx
const channel = usePulseChannel("chat-room-1");

// Fire-and-forget
channel.emit("typing", { userId: "123" });

// Request-response
const users = await channel.request("get_users");

// Subscribe to events
const unsubscribe = channel.on("user_joined", (user) => {
  console.log(`${user.name} joined`);
});

// Later: unsubscribe()
```

---

## PulseChannelResetError

Error thrown when a channel operation fails due to channel closure or disconnection.

```ts
class PulseChannelResetError extends Error {
  name: "PulseChannelResetError";
}
```

### Example

```tsx
try {
  const result = await channel.request("get_data");
} catch (error) {
  if (error instanceof PulseChannelResetError) {
    // Handle channel closure
    console.log("Channel closed:", error.message);
  }
}
```

---

## PulseForm

Form component that submits via fetch to keep the Pulse view mounted.

```tsx
const PulseForm = forwardRef<HTMLFormElement, PulseFormProps>(...)
```

### Props

```ts
interface PulseFormProps extends ComponentPropsWithoutRef<"form"> {
  action: string;  // Form action URL
}
```

### Example

```tsx
import { PulseForm } from "pulse-client";

function LoginForm() {
  return (
    <PulseForm action="/api/login">
      <input name="username" />
      <input name="password" type="password" />
      <button type="submit">Login</button>
    </PulseForm>
  );
}
```

---

## submitForm

Programmatically submits a form via fetch.

```ts
async function submitForm(options: SubmitFormOptions): Promise<void>
```

### Parameters

```ts
interface SubmitFormOptions {
  event: FormEvent<HTMLFormElement>;
  action: string;
  onSubmit?: (event: FormEvent<HTMLFormElement>) => void;
  formData?: FormData;
  force?: boolean;  // Submit even if event.defaultPrevented
}
```

### Example

```tsx
import { submitForm } from "pulse-client";

function handleSubmit(event: FormEvent<HTMLFormElement>) {
  submitForm({
    event,
    action: "/api/submit",
    formData: new FormData(event.currentTarget),
  });
}
```

---

## VDOMRenderer

Renders VDOM trees to React elements and applies incremental updates.

```ts
class VDOMRenderer {
  constructor(
    client: PulseSocketIOClient,
    path: string,
    registry?: ComponentRegistry
  );

  init(view: PulsePrerenderView): ReactNode;
  applyUpdates(tree: ReactNode, updates: VDOMUpdate[]): ReactNode;
  renderNode(node: VDOMNode, currentPath?: string): ReactNode;
  evaluateExpr(expr: VDOMNode): unknown;
}
```

### Methods

#### init

Initializes rendering from a prerendered view.

```ts
init(view: PulsePrerenderView): ReactNode
```

#### applyUpdates

Applies incremental VDOM updates to an existing React tree.

```ts
applyUpdates(tree: ReactNode, updates: VDOMUpdate[]): ReactNode
```

#### renderNode

Renders a single VDOM node to a React node.

```ts
renderNode(node: VDOMNode, currentPath?: string): ReactNode
```

#### evaluateExpr

Evaluates a VDOM expression node.

```ts
evaluateExpr(expr: VDOMNode): unknown
```

---

## PulseClient Interface

Interface for the Pulse client (implemented by `PulseSocketIOClient`).

```ts
interface PulseClient {
  connect(): Promise<void>;
  disconnect(): void;
  isConnected(): boolean;
  onConnectionChange(listener: ConnectionStatusListener): () => void;
  updateRoute(path: string, routeInfo: RouteInfo): void;
  invokeCallback(path: string, callback: string, args: any[]): void;
  attach(path: string, view: MountedView): void;
  detach(path: string): void;
}

type ConnectionStatus = "ok" | "connecting" | "reconnecting" | "error";
type ConnectionStatusListener = (status: ConnectionStatus) => void;

interface MountedView {
  routeInfo: RouteInfo;
  onInit: (view: PulsePrerenderView) => void;
  onUpdate: (ops: VDOMUpdate[]) => void;
  onJsExec: (msg: ServerJsExecMessage) => void;
  onServerError: (error: ServerError) => void;
}
```
